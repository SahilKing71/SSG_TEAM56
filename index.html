<script src="/socket.io/socket.io.js"></script>

<script>
    // Server سے کنکشن بنائیں
    const socket = io();

    const form = document.getElementById('form');
    const input = document.getElementById('input');
    const messages = document.getElementById('messages');

    // فنکشن: میسجز کو HTML میں شامل کرنا
    function addMessageToDOM(messageObject) {
        const item = document.createElement('li');
        // ہم نے Server سے پورا message object بھیجا ہے، اس لیے ہم messageObject.msg استعمال کریں گے
        item.textContent = messageObject.msg; 
        messages.appendChild(item);
        // Scroll down to see the newest message
        window.scrollTo(0, document.body.scrollHeight);
    }

    // جب user message بھیجے (Form Submit Event)
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        if (input.value) {
            // 'chat message' event کے ذریعے پیغام سرور کو بھیجیں
            // یہاں ہم صرف سادہ string بھیج رہے ہیں، جسے Server (index.js) سنبھالے گا
            socket.emit('chat message', input.value);
            input.value = '';
        }
    });

    // 1. جب Server سے پرانے میسجز (History) ملے (جب کوئی نیا user join کرے)
    socket.on('output messages', function(messagesArray) {
        // ہم میسجز کی Array کو iterate کر رہے ہیں
        messagesArray.forEach(msg => addMessageToDOM(msg));
    });

    // 2. جب Server سے کوئی نیا live message ملے
    socket.on('chat message', function(messageObject) {
        // ہم ایک message object کو شامل کر رہے ہیں
        addMessageToDOM(messageObject);
    });
</script>
